{"version":3,"sources":["turbopack:///[project]/lib/api/openLibrary.ts","turbopack:///[project]/app/books/[id]/BookDetailsClient.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/books/[id]/page.tsx"],"sourcesContent":["import {\r\n  Book,\r\n  SearchResponse,\r\n  BookDetails,\r\n  AuthorDetails,\r\n} from \"@/lib/types/book\";\r\n\r\nconst BASE_URL = \"https://openlibrary.org\";\r\nconst COVERS_URL = \"https://covers.openlibrary.org/b\";\r\nconst REQUEST_TIMEOUT = 5000; // 5 segundos\r\n\r\n/**\r\n * Construye la URL de la imagen de portada desde Open Library\r\n * @param coverId - ID de la portada desde la API\r\n * @param size - Tamaño de la imagen ('S', 'M', o 'L')\r\n * @returns URL completa de la imagen de portada\r\n */\r\nexport function getCoverUrl(\r\n  coverId: number,\r\n  size: \"S\" | \"M\" | \"L\" = \"M\"\r\n): string {\r\n  return `${COVERS_URL}/id/${coverId}-${size}.jpg`;\r\n}\r\n\r\n/**\r\n * Extrae el ID de la obra desde una clave de Open Library\r\n * @param key - Cadena de clave (ej: \"/works/OL27448W\")\r\n * @returns ID de la obra (ej: \"OL27448W\")\r\n */\r\nfunction extractWorkId(key: string): string {\r\n  const parts = key.split(\"/\");\r\n  return parts[parts.length - 1];\r\n}\r\n\r\n/**\r\n * Extrae y limpia el texto de descripción de varios formatos\r\n * @param description - Campo de descripción de la API (puede ser string u objeto)\r\n * @returns Descripción en texto plano\r\n */\r\nfunction extractDescription(\r\n  description: string | { type: string; value: string } | undefined\r\n): string | undefined {\r\n  if (!description) return undefined;\r\n  \r\n  let text = typeof description === \"string\" ? description : description.value;\r\n  \r\n  // Eliminar sección \"Contains\" y todo lo que viene después\r\n  const containsIndex = text.indexOf(\"**Contains**\");\r\n  if (containsIndex !== -1) {\r\n    text = text.substring(0, containsIndex).trim();\r\n  }\r\n  \r\n  // Eliminar enlaces markdown [texto](url) y mantener solo el texto\r\n  text = text.replace(/\\[([^\\]]+)\\]\\([^\\)]+\\)/g, \"$1\");\r\n  \r\n  // Eliminar enlaces de estilo referencia [texto][ref]\r\n  text = text.replace(/\\[([^\\]]+)\\]\\[\\d+\\]/g, \"$1\");\r\n  \r\n  // Eliminar referencias de enlaces al final [1]: url\r\n  text = text.replace(/\\[\\d+\\]:\\s*https?:\\/\\/[^\\s]+/g, \"\");\r\n  \r\n  // Limpiar espacios en blanco y saltos de línea extra\r\n  text = text.replace(/\\n{3,}/g, \"\\n\\n\").trim();\r\n  \r\n  return text || undefined;\r\n}\r\n\r\n/**\r\n * Busca libros usando la API de búsqueda de Open Library\r\n * @param query - Término de búsqueda\r\n * @returns Array de objetos Book\r\n * @throws Error si la petición falla o excede el tiempo límite\r\n */\r\nexport async function searchBooks(query: string): Promise<Book[]> {\r\n  if (!query || query.trim() === \"\") {\r\n    return [];\r\n  }\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);\r\n\r\n    const response = await fetch(\r\n      `${BASE_URL}/search.json?q=${encodeURIComponent(query)}&limit=20`,\r\n      {\r\n        signal: controller.signal,\r\n      }\r\n    );\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const data: SearchResponse = await response.json();\r\n\r\n    // Transformar resultados de búsqueda a interfaz Book\r\n    const books: Book[] = data.docs.map((doc) => ({\r\n      id: extractWorkId(doc.key),\r\n      title: doc.title,\r\n      author: doc.author_name || [\"Autor Desconocido\"],\r\n      coverUrl: doc.cover_i ? getCoverUrl(doc.cover_i, \"M\") : undefined,\r\n      firstPublishYear: doc.first_publish_year,\r\n    }));\r\n\r\n    return books;\r\n  } catch (error) {\r\n    if (error instanceof Error) {\r\n      if (error.name === \"AbortError\") {\r\n        throw new Error(\"La solicitud tardó demasiado tiempo. Intenta de nuevo.\");\r\n      }\r\n      throw new Error(`Error al buscar libros: ${error.message}`);\r\n    }\r\n    throw new Error(\"Error desconocido al buscar libros\");\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene información detallada de un libro específico\r\n * @param bookId - ID de la obra en Open Library (ej: \"OL27448W\")\r\n * @returns Objeto Book con información detallada\r\n * @throws Error si la petición falla o el libro no se encuentra\r\n */\r\nexport async function getBookDetails(bookId: string): Promise<Book> {\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);\r\n\r\n    // Obtener detalles del libro\r\n    const response = await fetch(`${BASE_URL}/works/${bookId}.json`, {\r\n      signal: controller.signal,\r\n      next: { revalidate: 86400 }, // Caché de 24 horas\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        throw new Error(\"Libro no encontrado\");\r\n      }\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const data: BookDetails = await response.json();\r\n\r\n    // Obtener nombres de autores si están disponibles (límite de 3 para rendimiento)\r\n    let authorNames: string[] = [\"Autor Desconocido\"];\r\n    if (data.authors && data.authors.length > 0) {\r\n      try {\r\n        const authorsToFetch = data.authors.slice(0, 3); // Limitar a 3 autores\r\n        const authorPromises = authorsToFetch.map(async (author) => {\r\n          const authorKey = author.author.key;\r\n          const controller = new AbortController();\r\n          const timeoutId = setTimeout(() => controller.abort(), 2000); // Timeout de 2 segundos por autor\r\n          \r\n          try {\r\n            const authorResponse = await fetch(`${BASE_URL}${authorKey}.json`, {\r\n              signal: controller.signal,\r\n              next: { revalidate: 604800 }, // Caché de 7 días para autores\r\n            });\r\n            clearTimeout(timeoutId);\r\n            \r\n            if (authorResponse.ok) {\r\n              const authorData: AuthorDetails = await authorResponse.json();\r\n              return authorData.name;\r\n            }\r\n          } catch {\r\n            clearTimeout(timeoutId);\r\n          }\r\n          return \"Autor Desconocido\";\r\n        });\r\n        authorNames = await Promise.all(authorPromises);\r\n      } catch (error) {\r\n        console.error(\"Error al obtener detalles de autores:\", error);\r\n      }\r\n    }\r\n\r\n    // Transformar a interfaz Book\r\n    const book: Book = {\r\n      id: extractWorkId(data.key),\r\n      title: data.title,\r\n      author: authorNames,\r\n      coverUrl: data.covers?.[0] ? getCoverUrl(data.covers[0], \"L\") : undefined,\r\n      firstPublishYear: data.first_publish_date\r\n        ? parseInt(data.first_publish_date.split(\"-\")[0])\r\n        : undefined,\r\n      description: extractDescription(data.description),\r\n    };\r\n\r\n    return book;\r\n  } catch (error) {\r\n    if (error instanceof Error) {\r\n      if (error.name === \"AbortError\") {\r\n        throw new Error(\"La solicitud tardó demasiado tiempo. Intenta de nuevo.\");\r\n      }\r\n      throw new Error(`Error al cargar el libro: ${error.message}`);\r\n    }\r\n    throw new Error(\"Error desconocido al cargar el libro\");\r\n  }\r\n}\r\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/books/[id]/BookDetailsClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/books/[id]/BookDetailsClient.tsx\",\n    \"default\",\n);\n","import { getBookDetails } from \"@/lib/api/openLibrary\";\r\nimport { Book } from \"@/lib/types/book\";\r\nimport BookDetailsClient from \"./BookDetailsClient\";\r\nimport { Metadata } from \"next\";\r\n\r\ninterface BookDetailsPageProps {\r\n  params: { id: string };\r\n}\r\n\r\n// Configuración de caché: revalidar cada 24 horas\r\nexport const revalidate = 86400;\r\n\r\nexport async function generateMetadata({\r\n  params,\r\n}: BookDetailsPageProps): Promise<Metadata> {\r\n  try {\r\n    const book = await getBookDetails(params.id);\r\n    return {\r\n      title: `${book.title} - Book Search App`,\r\n      description: book.description || `${book.title} por ${book.author.join(\", \")}`,\r\n    };\r\n  } catch {\r\n    return {\r\n      title: \"Libro no encontrado - Book Search App\",\r\n    };\r\n  }\r\n}\r\n\r\nexport default async function BookDetailsPage({\r\n  params,\r\n}: BookDetailsPageProps) {\r\n  let book: Book | null = null;\r\n  let error: string | null = null;\r\n\r\n  try {\r\n    book = await getBookDetails(params.id);\r\n  } catch (e) {\r\n    error = e instanceof Error ? e.message : \"No se pudo cargar el libro\";\r\n    console.error(\"Book details error:\", e);\r\n  }\r\n\r\n  if (!book && !error) {\r\n    error = \"Libro no encontrado\";\r\n  }\r\n\r\n  return <BookDetailsClient book={book} error={error} />;\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[1]}